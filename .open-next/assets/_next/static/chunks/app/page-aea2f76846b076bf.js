(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1083:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>f});var r=a(5155),n=a(2115),d=a(63),l=a(2619),t=a.n(l);function c(e){let{isConnected:s,onLogout:a}=e;return(0,r.jsx)("nav",{className:"navbar",children:(0,r.jsxs)("div",{className:"container navbar-content",children:[(0,r.jsxs)(t(),{href:"/",className:"logo",children:[(0,r.jsx)("div",{className:"logo-icon",children:"\uD83D\uDED2"}),(0,r.jsx)("span",{children:"Seller Hub"})]}),(0,r.jsx)("div",{children:s?(0,r.jsx)("button",{onClick:a,className:"btn btn-danger",children:"\uD83D\uDEAA Logout"}):(0,r.jsx)(t(),{href:"/api/auth",className:"btn btn-primary",children:"\uD83D\uDD17 Connect Shopee"})})]})})}function o(e){var s;let{shop:a,loading:n}=e;return n?(0,r.jsx)("div",{className:"card",children:(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("span",{children:"Loading shop info..."})]})}):a?(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"card-header",children:[(0,r.jsx)("span",{className:"card-title",children:"\uD83C\uDFEA Shop Information"}),a.status&&(e=>{switch(e){case"NORMAL":return(0,r.jsx)("span",{className:"badge badge-success",children:"Active"});case"FROZEN":return(0,r.jsx)("span",{className:"badge badge-warning",children:"Frozen"});case"BANNED":return(0,r.jsx)("span",{className:"badge badge-error",children:"Banned"});default:return(0,r.jsx)("span",{className:"badge badge-info",children:e})}})(a.status)]}),(0,r.jsxs)("div",{className:"shop-info",children:[(0,r.jsx)("div",{className:"shop-avatar",children:(null==(s=a.shop_name)?void 0:s.charAt(0).toUpperCase())||"S"}),(0,r.jsxs)("div",{className:"shop-details",children:[(0,r.jsx)("h3",{children:a.shop_name||"Unknown Shop"}),(0,r.jsxs)("div",{className:"shop-meta",children:[(0,r.jsxs)("span",{children:["\uD83D\uDCCD ",a.region||"Unknown Region"]}),a.is_cb&&(0,r.jsx)("span",{children:"\uD83C\uDF10 Cross-border"})]})]})]})]}):(0,r.jsx)("div",{className:"card",children:(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-state-icon",children:"\uD83C\uDFEA"}),(0,r.jsx)("p",{children:"No shop information available"})]})})}var i=a(8661),h=a.n(i);function m(e){let{isOpen:s,onClose:a,itemId:d,onSuccess:l}=e,[t,c]=(0,n.useState)([]),[o,i]=(0,n.useState)([]),[m,x]=(0,n.useState)(!0),[u,p]=(0,n.useState)(!1),[f,j]=(0,n.useState)(null),b=(0,n.useRef)(!1);(0,n.useEffect)(()=>{s&&d&&!b.current&&(b.current=!0,g()),s||(b.current=!1)},[s,d]);let g=async()=>{x(!0),j(null);try{var e,s,a,r;let n=await fetch("/api/products/models?item_id=".concat(d)),l=await n.json();if(console.log("Modal - Models response:",l),(null==(e=l.response)?void 0:e.model)&&l.response.model.length>0){c(l.response.model);let e=l.response.model.map(e=>{var s,a,r,n;let d=null!=(n=null!=(r=null==(a=e.seller_stock)||null==(s=a[0])?void 0:s.stock)?r:e.current_stock)?n:0;return{model_id:e.model_id,stock:d,stock_info_v2:e.stock_info_v2,original_stock:d,model_name:e.model_name}});console.log("Modal - Stock values:",e),console.log("Modal - Model Stock:",null==(r=e[0])||null==(a=r.stock_info_v2)||null==(s=a.summary_info)?void 0:s.total_available_stock),i(e)}else c([{model_id:0,model_name:"Default"}]),i([{model_id:0,stock:0,stock_info_v2:{summary_info:{total_available_stock:0,total_reserved_stock:0}},original_stock:0,model_name:"Default"}])}catch(e){console.error("Fetch models error:",e),j({type:"error",text:"Failed to load product models"})}finally{x(!1)}},v=()=>o.filter(e=>e.stock!==e.original_stock),N=async()=>{let e=v();if(0===e.length)return void j({type:"error",text:"No changes to save"});p(!0),j(null);try{let s=await fetch("/api/products/stock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:d,stock_items:e.map(e=>({model_id:e.model_id,stock:e.stock}))})}),r=await s.json();r.success?(j({type:"success",text:"✅ Updated ".concat(e.length," model(s) successfully!")}),setTimeout(()=>{l(),a()},1e3)):j({type:"error",text:"❌ ".concat(r.error||r.message||"Failed to update")})}catch(e){console.error("Update stock error:",e),j({type:"error",text:"❌ Network error"})}finally{p(!1)}};return s?(0,r.jsxs)("div",{onClick:a,className:"jsx-7de2fe1fc598db29 modal-overlay",children:[(0,r.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-7de2fe1fc598db29 modal-content",children:[(0,r.jsxs)("div",{className:"jsx-7de2fe1fc598db29 modal-header",children:[(0,r.jsxs)("h3",{className:"jsx-7de2fe1fc598db29",children:["\uD83D\uDCE6 Edit Stock - Item #",d]}),(0,r.jsx)("button",{onClick:a,className:"jsx-7de2fe1fc598db29 modal-close",children:"✕"})]}),f&&(0,r.jsx)("div",{className:"jsx-7de2fe1fc598db29 "+"message message-".concat(f.type),children:f.text}),(0,r.jsx)("div",{className:"jsx-7de2fe1fc598db29 modal-body",children:m?(0,r.jsxs)("div",{className:"jsx-7de2fe1fc598db29 loading-container",children:[(0,r.jsx)("div",{className:"jsx-7de2fe1fc598db29 spinner"}),(0,r.jsx)("span",{className:"jsx-7de2fe1fc598db29",children:"Loading models..."})]}):(0,r.jsxs)("div",{className:"jsx-7de2fe1fc598db29 stock-list",children:[(0,r.jsxs)("div",{className:"jsx-7de2fe1fc598db29 stock-list-header",children:[(0,r.jsx)("span",{className:"jsx-7de2fe1fc598db29",children:"Model"}),(0,r.jsx)("span",{className:"jsx-7de2fe1fc598db29",children:"Current"}),(0,r.jsx)("span",{className:"jsx-7de2fe1fc598db29",children:"New Stock"})]}),o.map(e=>{var s,a;return(0,r.jsxs)("div",{className:"jsx-7de2fe1fc598db29 stock-item",children:[(0,r.jsx)("span",{className:"jsx-7de2fe1fc598db29 model-name",children:e.model_name}),(0,r.jsx)("span",{className:"jsx-7de2fe1fc598db29 current-stock",children:null==(a=e.stock_info_v2)||null==(s=a.summary_info)?void 0:s.total_available_stock}),(0,r.jsx)("input",{type:"number",min:"0",value:e.stock,onChange:s=>((e,s)=>{let a=parseInt(s)||0;i(s=>s.map(s=>s.model_id===e?{...s,stock:a}:s))})(e.model_id,s.target.value),disabled:u,className:"jsx-7de2fe1fc598db29 stock-input"})]},e.model_id)})]})}),(0,r.jsxs)("div",{className:"jsx-7de2fe1fc598db29 modal-footer",children:[(0,r.jsxs)("span",{className:"jsx-7de2fe1fc598db29 change-count",children:[v().length," change(s)"]}),(0,r.jsxs)("div",{className:"jsx-7de2fe1fc598db29 modal-actions",children:[(0,r.jsx)("button",{onClick:a,disabled:u,className:"jsx-7de2fe1fc598db29 btn btn-secondary",children:"Cancel"}),(0,r.jsx)("button",{onClick:N,disabled:u||m||0===v().length,className:"jsx-7de2fe1fc598db29 btn btn-primary",children:u?"Updating...":"Save Changes"})]})]})]}),(0,r.jsx)(h(),{id:"7de2fe1fc598db29",children:".modal-overlay.jsx-7de2fe1fc598db29{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px)}.modal-content.jsx-7de2fe1fc598db29{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:16px;width:90%;max-width:500px;max-height:80vh;overflow:hidden;display:flex;flex-direction:column}.modal-header.jsx-7de2fe1fc598db29{display:flex;justify-content:space-between;align-items:center;padding:1.25rem 1.5rem;border-bottom:1px solid var(--border-color)}.modal-header.jsx-7de2fe1fc598db29 h3.jsx-7de2fe1fc598db29{margin:0;font-size:1.1rem}.modal-close.jsx-7de2fe1fc598db29{background:none;border:none;color:var(--text-secondary);font-size:1.25rem;cursor:pointer;padding:.25rem}.modal-close.jsx-7de2fe1fc598db29:hover{color:var(--text-primary)}.modal-body.jsx-7de2fe1fc598db29{padding:1.5rem;overflow-y:auto;flex:1}.stock-list.jsx-7de2fe1fc598db29{display:flex;flex-direction:column;gap:.75rem}.stock-list-header.jsx-7de2fe1fc598db29{display:grid;grid-template-columns:1fr 80px 100px;gap:1rem;padding:.5rem 0;color:var(--text-secondary);font-size:.75rem;text-transform:uppercase;letter-spacing:.05em;border-bottom:1px solid var(--border-color)}.stock-item.jsx-7de2fe1fc598db29{display:grid;grid-template-columns:1fr 80px 100px;gap:1rem;align-items:center;padding:.75rem 0;border-bottom:1px solid var(--border-color)}.model-name.jsx-7de2fe1fc598db29{font-weight:500;font-size:.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.current-stock.jsx-7de2fe1fc598db29{color:var(--text-secondary);text-align:center}.stock-input.jsx-7de2fe1fc598db29{width:100%;padding:.5rem;border-radius:8px;border:1px solid var(--border-color);background:var(--bg-primary);color:var(--text-primary);text-align:center;font-size:.9rem}.stock-input.jsx-7de2fe1fc598db29:focus{outline:none;border-color:var(--accent-primary)}.modal-footer.jsx-7de2fe1fc598db29{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.5rem;border-top:1px solid var(--border-color);background:var(--bg-primary)}.change-count.jsx-7de2fe1fc598db29{color:var(--text-secondary);font-size:.85rem}.modal-actions.jsx-7de2fe1fc598db29{display:flex;gap:.75rem}"})]}):null}function x(e){let{products:s,loading:a,hasMore:d,onStockUpdate:l}=e,[t,c]=(0,n.useState)(null);return a?(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("div",{className:"card-header",children:(0,r.jsx)("span",{className:"card-title",children:"\uD83D\uDCE6 Products"})}),(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("span",{children:"Loading products..."})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"card-header",children:[(0,r.jsx)("span",{className:"card-title",children:"\uD83D\uDCE6 Products"}),(0,r.jsxs)("span",{className:"badge badge-info",children:[s.length," items"]})]}),0===s.length?(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-state-icon",children:"\uD83D\uDCE6"}),(0,r.jsx)("p",{children:"No products found"}),(0,r.jsx)("span",{style:{fontSize:"0.875rem",marginTop:"0.5rem"},children:"Products from your Shopee store will appear here"})]}):(0,r.jsxs)("div",{className:"table-container",children:[(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Item ID"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Last Updated"}),(0,r.jsx)("th",{children:"Actions"})]})}),(0,r.jsx)("tbody",{children:s.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsxs)("strong",{children:["#",e.item_id]})}),(0,r.jsx)("td",{children:(e=>{switch(e){case"NORMAL":return(0,r.jsx)("span",{className:"badge badge-success",children:"Active"});case"BANNED":return(0,r.jsx)("span",{className:"badge badge-error",children:"Banned"});case"UNLIST":return(0,r.jsx)("span",{className:"badge badge-warning",children:"Unlisted"});default:return(0,r.jsx)("span",{className:"badge badge-info",children:e})}})(e.item_status)}),(0,r.jsx)("td",{style:{color:"var(--text-secondary)"},children:e.update_time?new Date(1e3*e.update_time).toLocaleDateString():"-"}),(0,r.jsx)("td",{children:(0,r.jsx)("button",{onClick:()=>{c(e.item_id)},className:"btn btn-secondary",style:{padding:"0.4rem 0.8rem",fontSize:"0.85rem"},children:"\uD83D\uDCDD Edit Stock"})})]},e.item_id))})]}),d&&(0,r.jsx)("div",{style:{textAlign:"center",padding:"1rem"},children:(0,r.jsx)("span",{style:{color:"var(--text-secondary)",fontSize:"0.875rem"},children:"More products available..."})})]})]}),null!==t&&(0,r.jsx)(m,{isOpen:null!==t,onClose:()=>{c(null)},itemId:t,onSuccess:()=>{l&&l()}})]})}function u(e){let{orders:s,loading:a,hasMore:n}=e;return a?(0,r.jsxs)("div",{className:"card",children:[(0,r.jsx)("div",{className:"card-header",children:(0,r.jsx)("span",{className:"card-title",children:"\uD83D\uDECD️ Recent Orders"})}),(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("span",{children:"Loading orders..."})]})]}):(0,r.jsxs)("div",{className:"card",children:[(0,r.jsxs)("div",{className:"card-header",children:[(0,r.jsx)("span",{className:"card-title",children:"\uD83D\uDECD️ Recent Orders"}),(0,r.jsxs)("span",{className:"badge badge-info",children:[s.length," orders"]})]}),0===s.length?(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-state-icon",children:"\uD83D\uDECD️"}),(0,r.jsx)("p",{children:"No orders found"}),(0,r.jsx)("span",{style:{fontSize:"0.875rem",marginTop:"0.5rem"},children:"Orders from the last 15 days will appear here"})]}):(0,r.jsxs)("div",{className:"table-container",children:[(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Order ID"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Created"})]})}),(0,r.jsx)("tbody",{children:s.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:(0,r.jsx)("strong",{children:e.order_sn})}),(0,r.jsx)("td",{children:(e=>{let s={UNPAID:{class:"badge-warning",label:"Unpaid"},READY_TO_SHIP:{class:"badge-info",label:"Ready to Ship"},PROCESSED:{class:"badge-info",label:"Processed"},SHIPPED:{class:"badge-info",label:"Shipped"},COMPLETED:{class:"badge-success",label:"Completed"},IN_CANCEL:{class:"badge-warning",label:"Cancelling"},CANCELLED:{class:"badge-error",label:"Cancelled"},INVOICE_PENDING:{class:"badge-warning",label:"Invoice Pending"}}[e]||{class:"badge-info",label:e};return(0,r.jsx)("span",{className:"badge ".concat(s.class),children:s.label})})(e.order_status)}),(0,r.jsx)("td",{style:{color:"var(--text-secondary)"},children:e.create_time?new Date(1e3*e.create_time).toLocaleDateString():"-"})]},e.order_sn))})]}),n&&(0,r.jsx)("div",{style:{textAlign:"center",padding:"1rem"},children:(0,r.jsx)("span",{style:{color:"var(--text-secondary)",fontSize:"0.875rem"},children:"More orders available..."})})]})]})}function p(){let e=(0,d.useSearchParams)(),[s,a]=(0,n.useState)(!1),[l,t]=(0,n.useState)(!0),[i,h]=(0,n.useState)(!1),[m,p]=(0,n.useState)(!1),[f,j]=(0,n.useState)(!1),[b,g]=(0,n.useState)(null),[v,N]=(0,n.useState)([]),[y,D]=(0,n.useState)([]),[_,k]=(0,n.useState)(!1),[S,C]=(0,n.useState)(!1),[w,E]=(0,n.useState)(null);(0,n.useEffect)(()=>{let s=e.get("connected"),a=e.get("error");"true"===s?E({type:"success",text:"✅ Successfully connected to Shopee!"}):a&&E({type:"error",text:"❌ Error: ".concat(a)});let r=setTimeout(()=>E(null),5e3);return()=>clearTimeout(r)},[e]),(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/status"),s=await e.json();a(s.isConnected)}catch(e){console.error("Auth check failed:",e)}finally{t(!1)}})()},[]);let A=(0,n.useCallback)(async()=>{var e,a;if(s){h(!0);try{let e=await fetch("/api/shop"),s=await e.json();console.log("Shop API Response:",s),s.response?g(s.response):s.shop_name?g(s):s.error&&console.error("Shop API error:",s.error,s.message)}catch(e){console.error("Shop fetch failed:",e)}finally{h(!1)}p(!0);try{let s=await fetch("/api/products"),a=await s.json();(null==(e=a.response)?void 0:e.item)&&(N(a.response.item),k(a.response.has_next_page))}catch(e){console.error("Products fetch failed:",e)}finally{p(!1)}j(!0);try{let e=await fetch("/api/orders"),s=await e.json();console.log("Orders API Response:",s),(null==(a=s.response)?void 0:a.order_list)?(D(s.response.order_list),C(s.response.more)):s.order_list&&(D(s.order_list),C(s.more))}catch(e){console.error("Orders fetch failed:",e)}finally{j(!1)}}},[s]);(0,n.useEffect)(()=>{A()},[A]);let I=async()=>{try{await fetch("/api/auth/status",{method:"DELETE"}),a(!1),g(null),N([]),D([]),E({type:"success",text:"\uD83D\uDC4B Logged out successfully"})}catch(e){console.error("Logout failed:",e)}};return l?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c,{isConnected:!1}),(0,r.jsx)("main",{className:"container",children:(0,r.jsxs)("div",{className:"loading-container",style:{minHeight:"60vh"},children:[(0,r.jsx)("div",{className:"spinner",style:{width:"40px",height:"40px"}}),(0,r.jsx)("span",{children:"Loading..."})]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c,{isConnected:s,onLogout:I}),(0,r.jsxs)("main",{className:"container",children:[w&&(0,r.jsx)("div",{className:"message message-".concat(w.type),style:{marginTop:"1rem"},children:w.text}),s?(0,r.jsxs)("section",{className:"dashboard",children:[(0,r.jsxs)("div",{className:"dashboard-header",children:[(0,r.jsx)("h1",{children:"Welcome back! \uD83D\uDC4B"}),(0,r.jsx)("p",{children:"Here's what's happening with your store today."})]}),(0,r.jsx)("div",{style:{marginBottom:"1.5rem"},children:(0,r.jsx)(o,{shop:b,loading:i})}),(0,r.jsxs)("div",{className:"grid grid-2",children:[(0,r.jsx)(x,{products:v,loading:m,hasMore:_,onStockUpdate:A}),(0,r.jsx)(u,{orders:y,loading:f,hasMore:S})]})]}):(0,r.jsxs)("section",{className:"hero",children:[(0,r.jsx)("h1",{children:"Shopee Seller Hub"}),(0,r.jsx)("p",{children:"Connect your Shopee store and manage everything from one beautiful dashboard. View your shop info, products, and orders at a glance."}),(0,r.jsx)("a",{href:"/api/auth",className:"btn btn-primary",style:{fontSize:"1.1rem",padding:"1rem 2rem"},children:"\uD83D\uDD17 Connect Your Shopee Store"}),(0,r.jsxs)("div",{className:"features",children:[(0,r.jsxs)("div",{className:"feature",children:[(0,r.jsx)("span",{className:"feature-icon",children:"\uD83C\uDFEA"}),(0,r.jsx)("span",{children:"Shop Info"})]}),(0,r.jsxs)("div",{className:"feature",children:[(0,r.jsx)("span",{className:"feature-icon",children:"\uD83D\uDCE6"}),(0,r.jsx)("span",{children:"Products"})]}),(0,r.jsxs)("div",{className:"feature",children:[(0,r.jsx)("span",{className:"feature-icon",children:"\uD83D\uDECD️"}),(0,r.jsx)("span",{children:"Orders"})]}),(0,r.jsxs)("div",{className:"feature",children:[(0,r.jsx)("span",{className:"feature-icon",children:"\uD83D\uDCCA"}),(0,r.jsx)("span",{children:"Analytics"})]})]})]}),(0,r.jsx)("footer",{className:"footer",children:(0,r.jsx)("p",{children:"Shopee Seller Hub \xa9 2024. Built with ❤️ for Shopee sellers."})})]})]})}function f(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:"container",style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsxs)("div",{className:"loading-container",children:[(0,r.jsx)("div",{className:"spinner",style:{width:"40px",height:"40px"}}),(0,r.jsx)("span",{children:"Loading..."})]})}),children:(0,r.jsx)(p,{})})}},5894:(e,s,a)=>{Promise.resolve().then(a.bind(a,1083))}},e=>{e.O(0,[724,441,255,358],()=>e(e.s=5894)),_N_E=e.O()}]);